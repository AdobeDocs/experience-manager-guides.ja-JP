---
title: バージョン管理
description: バージョン管理の仕組みを学ぶ
exl-id: 24e44618-9c4e-4547-a00d-216ef3fb4854
feature: Version Management
role: Admin
level: Experienced
source-git-commit: 0513ecac38840a4cc649758bd1180edff1f8aed1
workflow-type: tm+mt
source-wordcount: '1662'
ht-degree: 0%

---

# バージョン管理 {#id181GB000XY4}

バージョン管理は、あらゆるコンテンツ管理システムにおける重要な側面です。 これにより、特定の時点でのデジタルアセットのスナップショットを作成できます。 デジタルアセットのバージョンを設定しておくと、必要なバージョンのアセットを復元して更新できます。 通常、アセットのバージョンを作成する場合、必要なアセットをチェックアウトしてチェックインします。

管理者は、ユーザーがファイルをチェックアウトせずに編集することを制限するルールを適用できます。 同様に、データの損失を回避するために、チェックアウトされたすべてのファイルがチェックインされて戻されていることを確認できます。

複数のユーザーが使用する環境では、ユーザーがシステムからファイルを削除しないようにすることも重要です。 この要件は、他のユーザーによってチェックアウトされているファイルに対してより重要です。ユーザーによる他のユーザーによってチェックアウトされているファイルの上書きを許可または禁止することができます。 チェックアウトされたファイルがユーザーによって誤ってシステムから削除されるのを防ぐために、AEM Guidesでは次の設定を使用できます。 チェックアウトしたファイルに加えて、参照を含むファイルや他のファイルから参照されるファイルの削除をコントロールすることもできます。 また、アップロードしたファイルの新しいバージョンを作成することもできます。

## アップロードしたファイルの新しいバージョンを作成

>[!NOTE]
>
> この設定は、ファイルのアップロード時にのみ適用されます。

アップロードしたファイルの新しいバージョンを作成するには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするためのデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. **com.adobe.fmdita.config.ConfigManager** バンドルを検索してクリックします。

1. 「**アップロードしたファイルの新しいバージョンを作成**」オプションを選択します。

   デフォルトでは、このオプションはオフになっています。

   このオプションを選択すると、新しいバージョン管理メカニズムが発生し、以降のアップロードではデフォルトのアップロード動作が上書きされるので、アップロードされたファイルの内容が新しいバージョンとして保存されます。 このオプションの選択を解除すると、AEM GuidesではAEMのデフォルトのバージョン管理メカニズムが使用されます。

1. 「**保存**」をクリックします。


>[!NOTE]
>
> プロパティ **アップロードされたファイルの新しいバージョンを作成**\（create.ver.new.content\）を有効にし、**Assets UI** を使用してアセットを一括アップロードする場合、70 個以下のバッチでファイルをアップロードできます。

## チェックアウトされたファイルの編集を許可するように設定を構成する

AEM Guidesの Web エディタを使用すると、DITA トピックを作成および更新できます。 Web エディターを設定して、リポジトリからチェックアウトされたドキュメントのみを編集できます。 これにより、別のライターが編集するために開いたトピックを、他のライターが誤って上書きしないようにします。 編集用にトピックを開くと、作成者はファイルを閉じるときにファイルをチェックインできます。

もう 1 つの重要なルールは、チェックアウトされたファイルがシステムにチェックインされることを確認することです。 これにより、ユーザーがチェックインせずに誤ってファイルを閉じてしまうことを防ぐことができます。

これらの機能を有効にするには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするためのデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. **com.adobe.fmdita.xmleditor.config.XmlEditorConfig** バンドルを検索してクリックします。

1. 「**チェックアウトなしの編集を無効にする**」オプションを選択します。

   ![](assets/xml-editor-config.png){width="650" align="left"}

   このオプションを使用すると、ファイルをチェックアウトするまで、ツールバーに「編集」オプションが表示されません。

1. チェックアウトしたファイルを保存したりリポジトリにチェックインしたりせずに閉じるたびに警告メッセージを表示するには、[**閉じるときにチェックインを要求**] オプションを選択します。

1. 「**保存**」をクリックします。


>[!NOTE]
>
> この機能のオン/オフに関係なく、トピック プレビューでは常に [ チェックアウト ] および [ チェックイン ] オプションが使用できます。

## チェックアウトしたファイルをアップロード時に上書き

>[!NOTE]
>
> この設定は、Assets UI からファイルを作成する場合にのみ適用され、WebDAV ツールを使用してファイルをアップロードする場合には適用されません。

ユーザーがアップロード時に、自分または他のユーザーによってチェックアウトされたファイルを上書きできるようにするには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするためのデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. **com.adobe.fmdita.config.ConfigManager** バンドルを検索してクリックします。

1. 「**アップロード時にチェックアウトしたファイルを上書き**」オプションを選択します。

   デフォルトでは、このオプションはオンになっています。 このオプションを選択すると、チェックアウトされたファイルを上書きできます。 このオプションを選択しない場合、ユーザーまたは他のユーザーによってチェックアウトされているファイルは上書きされません。

1. 「**保存**」をクリックします。


## チェックアウトしたファイルの削除を禁止する

自分または他のユーザーがチェックアウトしたファイルをユーザーが誤って削除するのを防ぐには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするためのデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. **com.adobe.fmdita.xmleditor.config.XmlEditorConfig** バンドルを検索してクリックします。

1. 「**チェックアウトされたコンテンツの削除を防ぐ**」オプションを選択します。

   デフォルトでは、このオプションはオンになっています。 このオプションを選択すると、チェックアウトされたファイルを削除できなくなります。

1. 「**保存**」をクリックします。


この機能をサポートするために、新しいインデックスプロパティ `drivelock` が `oak:index` に追加されました。

`/oak:index/damAssetLucene/indexRules/dam:Asset/properties/drivelock`

![](assets/index-property-oak-index-drivelock.png){width="800" align="left"}

新しいインデックスプロパティに加えて、次のプロパティが `/oak:index/damAssetLucene` に設定されていることを確認します。

- `jcr:primaryType`=`"oak:QueryIndexDefinition"`
- `async`=`"async"`
- `compatVersion`=`"{Long}2"`
- `evaluatePathRestrictions`=`"{Boolean}true"`
- `reindex`=`"{Boolean}false"`
- `reindexCount`=`"{Long}3"` *\（これはインデックス再作成の実行回数のカウントで、このパッケージのインストールに置き換えられます\）*
- `type`=`"lucene"`

>[!NOTE]
>
> `reindex` の値は、`"{Boolean}true"` に変更することができます。 これにより、フォルダーの階層内にあるチェックアウトされたファイルの検索結果を高速化できます。

## 参照ファイルの削除を防ぐ

管理者は、AEM リポジトリからファイルを削除できるユーザーを制御できます。 特に、ファイルに参照が含まれていたり、他のファイルによって参照されている場合は、そのようなファイルを削除できるユーザーを定義できます。

この設定を使用すると、すべてのユーザーによるファイルの削除を許可または禁止したり、特定のユーザーグループによるファイルの削除のみを許可したりできます。 ファイルの削除が許可されている場合は、次のプロセスに従います。

- すべての参照元ファイルと参照元ファイルを含むフォルダーを削除すると、すべてのファイルが削除されます。 プロセスでは、まず参照を含まないすべてのファイルが削除され、次に参照を含むファイルまたは参照されているファイルが削除されます。

- フォルダを削除するときに、フォルダ内のファイルがそのフォルダの外部にあるファイルによって参照されている場合は、ファイルを削除する前に参照を削除するよう求められます。


参照を含むファイルまたは他のファイルによって参照されているファイルを削除できるユーザーを定義するには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするためのデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. **com.adobe.fmdita.config.ConfigManager** バンドルを検索してクリックします。

1. 「**参照元のAssetsのブロック削除**」オプションを見つけます。

1. 削除のアクセス権を付与するユーザーに応じて、次のいずれかの定数を指定します。

   - allow\_unsafe\_delete\_for\_all：すべてのユーザーにファイルの削除権限を付与します。 この場合、ファイル\（s\）に参照が含まれていたり、他のファイルによって参照されている場合は、そのファイル\（s\）を強制的に削除することもできます。 ファイルを削除する前に、参照を含むプロンプトが表示されます。削除操作をキャンセルし、参照を削除して、最後にファイルを削除できます。 または、参照を削除せずにファイル\（s\）を強制的に削除できます。

     ![](assets/allow_unsafe_delete-force-delete.PNG){width="550" align="left"}

   - allow\_unsafe\_delete\_for\_delete\_assets\_group：管理者または *delete-assets* グループに属するユーザーは、ファイルを削除できます。 他のユーザーが参照を含むファイルを削除しようとすると、すべての参照が削除されるまで、そのようなファイルを削除することはできません。 次のスクリーンショットは、権限を持たないユーザーがファイルを削除しようとすると表示されます。

     ![](assets/allow_unsafe_delete_for_delete_assets_group.PNG){width="550" align="left"}

   - block\_unsafe\_delete\_for\_all: ファイル\（s\）への参照とファイルからの参照が削除されるまで、すべてのユーザー\（Administrators\）がファイルを削除することを許可しません。

1. 「**保存**」をクリックします。


## 古いバージョンの DITA ファイルをパージする

コンテンツを更新して新しいバージョンを作成すると、以前のバージョンの DITA ファイルがリポジトリに保持されます。 DITA ファイル用に作成されるバージョンの数が多いと、リポジトリの容量が大量に消費される可能性があります。 AEM Guidesでは、リポジトリから削除する必要がある古いバージョンを設定できます。

管理者権限がある場合は、指定された URL を使用してこのユーティリティにアクセスできます。

`<server folder path> /libs/fmdita/clientlibs/xmleditor_version_purge/page.html`

指定した基準のいずれかを満たす DITA ファイルのバージョンは維持され、パージされません。

- ファイルの最初のバージョン
- ベースラインに含まれる
- あらゆる翻訳またはレビューワークフローに含まれる
- ラベルが適用されています
- 定義された年齢またはバージョン数の条件を満たしています

古いバージョンをパージするには、次の手順を実行します。

1. パージするファイルに関する次の詳細を入力します。

   ![](assets/preview-purge-report.png){width="350" align="left"}

1. 
   - **最新バージョンから保持するバージョンの数**：保持し、パージしないバージョンの数を入力します。 例えば、「5」と入力した場合、最後の 5 つのバージョンが保持され、その前のバージョンは、他のパージ条件が満たされた場合にパージの対象として認定されます。
- **期間内に作成されたバージョンを保持\（日数\）**: バージョンの最長有効期間を日数で入力します。 指定された日数より古いバージョンは、他のパージ条件が満たされた場合にパージの対象となります。 例えば、100 と入力した場合、100 日前に作成されたすべてのバージョンは、他のパージ条件が満たされた場合にパージの対象となります。
- **パス**：ファイルをパージするファイルまたはフォルダーのパスを選択します。

  >[!NOTE]
  >
  > パージできるのは DITA ファイルのみです。

1. **Preview Purge Report** をクリックします。

   >[!NOTE]
   >
   > パージタスクは一度に 1 つしか存在できません。 処理中のバージョンがある場合は、別のバージョンのパージ操作を開始することはできません。

   バージョンのパージレポートが生成されます。

1. バージョンのパージレポートをダウンロードして、パージされるファイルとバージョンを確認します。
1. **パージをキャンセル** または **パージを開始** を選択できます。

   ![](assets/download-purge-report.png){width="350" align="left"}

   パージステータスが表示されます。

   **バージョンのパージレポートをダウンロード** をクリックして、パージされたバージョンを表示します。 このレポートには、すべてのバージョンのパージのステータスと、特定のバージョンが保持された理由またはパージされた理由が表示されます。


>[!NOTE]
>
> レポートは/var/dxml/versionpurge にダウンロードされます。
