---
title: バージョン管理
description: バージョン管理の仕組みを説明します。
exl-id: 24e44618-9c4e-4547-a00d-216ef3fb4854
source-git-commit: 5e0584f1bf0216b8b00f00b9fe46fa682c244e08
workflow-type: tm+mt
source-wordcount: '1662'
ht-degree: 0%

---

# バージョン管理 {#id181GB000XY4}

バージョン管理は、あらゆるコンテンツ管理システムの重要な側面です。 特定の時点でのデジタルアセットのスナップショットを作成できます。 デジタルアセットのバージョンを用意したら、必要なバージョンのアセットを復元して更新できます。 通常、任意のアセットのバージョンを作成する場合は、必要なアセットをチェックアウトしてチェックインします。

管理者は、チェックアウトせずにユーザーがファイルを編集できないようにするルールを適用できます。 同様に、チェックアウトしたすべてのファイルをチェックインして、データの損失を防ぐことができます。

複数使用の環境では、ユーザーがシステムからファイルを削除しないようにすることも重要です。 この要件は、他のユーザーがチェックアウトしたファイルに対してより重要です。他のユーザーがチェックアウトしたファイルをユーザーが上書きするのを許可または防止できます。 ユーザーがチェックアウトしたファイルをシステムから誤って削除するのを防ぐため、AEMガイドでは、使用できる設定を提供しています。 チェックアウトしたファイルに加えて、参照を含むファイルや他のファイルから参照されるファイルの削除を制御することもできます。 また、アップロードしたファイルの新しいバージョンを作成することもできます。

## アップロードしたファイルの新しいバージョンを作成

>[!NOTE]
>
> この設定は、ファイルのアップロード時にのみ適用できます。

アップロードしたファイルの新しいバージョンを作成するには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. を検索して、 **com.adobe.fmdita.config.ConfigManager** バンドル。

1. を選択します。 **アップロードしたファイルの新しいバージョンを作成** オプション。

   デフォルトでは、このオプションはオフになっています。

   このオプションを選択すると、新しいバージョン管理メカニズムが実行され、以降のアップロードで使用されるデフォルトのアップロード動作が上書きされ、アップロードされたファイルの内容が新しいバージョンとして保存されます。 このオプションの選択を解除した場合、AEM Guides はAEMのデフォルトのバージョン管理メカニズムを使用します。

1. 「**保存**」をクリックします。


>[!NOTE]
>
> プロパティを有効にすると、70 個以下のバッチでファイルをアップロードできます **アップロードしたファイルの新しいバージョンを作成** \(create.ver.new.content\) を使用し、 **Assets UI**&#x200B;をクリックして、アセットを一括アップロードします。

## チェックアウトしたファイルの編集を許可する設定を構成します

AEM Guides の Web エディターを使用すると、DITA トピックを作成および更新できます。 Web エディターを設定して、リポジトリからチェックアウトされたドキュメントのみを編集できるようにすることができます。 これにより、他のライターが誤って別のライターが編集用に開いたトピックを上書きすることを防ぐことができます。 トピックを開いて編集した後、作成者はファイルを閉じる際にファイルをチェックインできます。

もう 1 つの重要なルールは、チェックアウトされたファイルを確実にシステムにチェックインすることです。 これにより、ユーザーがチェックインせずに誤ってファイルを閉じるのを防ぎます。

これらの機能を有効にするには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. を検索して、 **com.adobe.fmdita.xmleditor.config.XmlEditorConfig** バンドル。

1. を選択します。 **チェックアウトなしで編集を無効にする** オプション。

   ![](assets/xml-editor-config.png){width="650" align="left"}

   このオプションを選択した場合、ユーザーはファイルをチェックアウトするまでツールバーに「編集」オプションが表示されません。

1. を選択します。 **閉じるときにチェックインを求める** オプションを使用します。

1. 「**保存**」をクリックします。


>[!NOTE]
>
> この機能のオン/オフに関係なく、トピックプレビューでは、常に「チェックアウト」と「チェックイン」の各オプションを使用できます。

## アップロード時にチェックアウトしたファイルを上書き

>[!NOTE]
>
> この設定は、Assets UI からファイルを作成する場合にのみ適用され、WebDAV ツールを使用してファイルをアップロードする場合には適用されません。

ユーザーがチェックアウトしたファイルや他のユーザーがアップロード時にファイルを上書きできるようにするには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. を検索して、 **com.adobe.fmdita.config.ConfigManager** バンドル。

1. を選択します。 **チェックアウトしたファイルをアップロード時に上書き** オプション。

   デフォルトでは、このオプションはオンになっています。 このオプションを選択すると、チェックアウトされたファイルを上書きできます。 このオプションが選択されていない場合、ファイルがチェックアウトされた場合や他のユーザーによって上書きされることはありません。

1. 「**保存**」をクリックします。


## チェックアウトしたファイルの削除を禁止する

ユーザーがチェックアウトしたファイルや他のユーザーが誤って削除するのを防ぐには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. を検索して、 **com.adobe.fmdita.xmleditor.config.XmlEditorConfig** バンドル。

1. を選択します。 **チェックアウトしたコンテンツの削除を防ぐ** オプション。

   デフォルトでは、このオプションはオンになっています。 このオプションを選択すると、ユーザーはチェックアウトされたファイルを削除できなくなります。

1. 「**保存**」をクリックします。


この機能をサポートするには、新しいインデックスプロパティを使用します。 `drivelock` が `oak:index`:

`/oak:index/damAssetLucene/indexRules/dam:Asset/properties/drivelock`

![](assets/index-property-oak-index-drivelock.png){width="800" align="left"}

新しい index プロパティに加えて、次のプロパティがに設定されていることを確認します。 `/oak:index/damAssetLucene`:

- `jcr:primaryType`=`"oak:QueryIndexDefinition"`
- `async`=`"async"`
- `compatVersion`=`"{Long}2"`
- `evaluatePathRestrictions`=`"{Boolean}true"`
- `reindex`=`"{Boolean}false"`
- `reindexCount`=`"{Long}3"` *\（これはインデックスの再作成が行われた回数です。パッケージのインストールで置き換えられます）*
- `type`=`"lucene"`

>[!NOTE]
>
> 値は `reindex` から `"{Boolean}true"`. これにより、フォルダーの階層内のチェックアウト済みファイルの検索結果が高速になります。

## 参照ファイルの削除を防ぐ

管理者は、AEMリポジトリからファイルを削除できるユーザーを制御できます。 特に、ファイルに参照が含まれている場合や、他のファイルによって参照されている場合は、そのようなファイルを削除できるユーザーを定義できます。

この設定を使用すると、すべてのユーザーに対してファイルの削除を許可または禁止したり、特定のユーザーグループに対してのみファイルの削除を許可したりできます。 ファイルの削除が許可されている場合は、次の処理が実行されます。

- 参照ファイルと参照ファイルをすべて含むフォルダを削除する場合は、すべてのファイルが削除されます。 プロセスは、参照を含まないすべてのファイルを最初に削除し、その後に参照を含むまたは参照されるファイルを削除します。

- フォルダを削除し、そのフォルダ内のファイルがそのフォルダの外のファイルによって参照されている場合は、参照を削除するよう求められた後で、ファイルを削除します。


参照を含むファイル、または他のファイルから参照されるファイルを削除できるユーザーを定義するには、次の手順を実行します。

1. Adobe Experience Manager Web コンソール設定ページを開きます。

   設定ページにアクセスするデフォルトの URL は次のとおりです。

   ```http
   http://<server name>:<port>/system/console/configMgr
   ```

1. を検索して、 **com.adobe.fmdita.config.ConfigManager** バンドル。

1. 次を見つけます。 **参照元アセットのブロック削除** オプション。

1. 削除のアクセス権を付与するユーザーに応じて、次のいずれかの定数を指定します。

   - allow\_unsafe\_delete\_for\_all：ファイルを削除する権限をすべてのユーザーに与えます。 この場合、ファイルに参照が含まれているか、他のファイルが参照している場合は、そのようなファイルを強制的に削除することもできます。 ファイルを削除する前に、参照を示すプロンプトが表示され、削除操作をキャンセルし、参照を削除してから、最後にファイルを削除できます。 または、参照を削除せずに強制的にファイルを削除することもできます。

     ![](assets/allow_unsafe_delete-force-delete.PNG){width="550" align="left"}

   - allow\_unsafe\_delete\_for\_delete\_assets\_group：管理者または *delete-assets* グループはファイルを削除できます。 参照を持つファイルを他のユーザーが削除しようとした場合、すべての参照が削除されるまで、そのようなファイルの削除は許可されません。 権限を持たないユーザーがファイルの削除を試みると、次のスクリーンショットが表示されます。

     ![](assets/allow_unsafe_delete_for_delete_assets_group.PNG){width="550" align="left"}

   - block\_unsafe\_delete\_for\_all：ファイルへの参照とファイルからの参照が削除されるまで、すべてのユーザー（管理者を含む）に対してファイルの削除を許可しません。

1. 「**保存**」をクリックします。


## DITA ファイルの古いバージョンのパージ

コンテンツを更新し、新しいバージョンを作成すると、以前のバージョンの DITA ファイルがリポジトリに保持されます。 多くのバージョンが、ある期間に DITA ファイル用に作成され、また、複数のバージョンをまとめてリポジトリ内の大量の領域を占有する場合があります。 AEMガイドを使用すると、リポジトリから削除する必要がある古いバージョンを設定できます。

管理者権限を持っている場合は、指定された URL を使用してこのユーティリティにアクセスできます。

`<server folder path> /libs/fmdita/clientlibs/xmleditor_version_purge/page.html`

指定した条件のいずれかを満たす DITA ファイルのバージョンは維持され、パージされません。

- ファイルの最初のバージョンです
- ベースラインに含まれる
- 任意の翻訳またはレビューワークフローに含まれる
- ラベルが適用されている
- 定義された年齢またはバージョンの条件を満たす

以前のバージョンをパージするには、次の手順を実行します。

1. パージするファイルに関する次の詳細を入力します。

   ![](assets/preview-purge-report.png){width="350" align="left"}

1. 
   - **最新バージョンから保持するバージョンの数**：保持し、パージしないバージョンの数を入力します。 例えば、5 と入力すると、最近の 5 つのバージョンが保持され、それより前のバージョンは、他のパージ条件が満たされた場合にパージされる資格があります。
- **期間内に作成されたバージョンを保持\（日数）**：バージョンの最大有効期間を日数で入力します。 指定された日数より古いバージョンは、他のパージ条件が満たされた場合にパージされる資格があります。 例えば、100 と入力した場合、他のパージ条件が満たされた場合に、100 日より前に作成されたすべてのバージョンがパージ対象として認定されます。
- **パス**：ファイルをパージするファイルまたはフォルダーのパスを選択します。

  >[!NOTE]
  >
  > DITA ファイルのみをパージできます。

1. クリック **パージレポートのプレビュー**.

   >[!NOTE]
   >
   > 一度に 1 つのパージタスクのみ存在します。 処理中のバージョンのパージ操作は開始できません。

   バージョンのパージレポートが生成されます。

1. バージョンのパージレポートをダウンロードし、パージされるファイルとバージョンを確認します。
1. 次の項目を選択できます。 **パージをキャンセル** または **パージを開始**.

   ![](assets/download-purge-report.png){width="350" align="left"}

   パージステータスが表示されます。

   クリック **バージョンのパージレポートをダウンロード** ：パージされたバージョンを表示します。 このレポートは、すべてのバージョンのパージステータスと、特定のバージョンが保持された理由、またはパージされた理由を表示します。


>[!NOTE]
>
> レポートは次の場所にダウンロードされます。 /var/dxml/versionpurge
